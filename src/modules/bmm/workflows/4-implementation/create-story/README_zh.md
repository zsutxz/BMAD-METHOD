---
last-redoc-date: 2025-10-01
---

# 创建故事工作流

create-story工作流是v6及时故事生成方法的入口点，专门由Scrum Master（SM）代理运行。与批量处理方法论不同，此工作流基于当前史诗待办事项状态一次只生成一个故事，确保故事只在需要时创建并使用最新的上下文。SM分析史诗的进展，根据epics.md枚举识别接下来需要构建的内容，并生成完整的故事规范，包括直接从技术规格、PRD和架构文档中提取的验收标准、技术方法和实施指导。

此工作流代表了从传统前期规划到自适应故事生成的根本转变。通过一次创建一个故事并强制对epics.md进行严格验证，SM确保只创建经过规划和批准的故事。工作流默认在非交互式"#yolo"模式下运行，在通过严格的源文档接地保持质量的同时最小化提示。如果epics.md没有明确枚举下一个故事，它将停止，强制通过correct-course工作流进行适当的规划，而不是允许临时故事创建。

工作流的智能文档发现系统自动找到当前史诗的相关技术规格（使用模式`tech-spec-epic-{epic_num}-*.md`），从docs/和output文件夹加载所有架构文档，并按优先级顺序从多个来源综合需求。故事创建后，它可以可选地触发story-context工作流为开发人员生成及时的技术专业知识。

## 使用方法

```bash
# SM启动下一个工作片段的故事创建
bmad sm *create-story
```

SM在以下情况下运行此工作流：

- 当前冲刺有新工作的容量
- 前一个故事状态为"完成"或"已批准"
- 团队准备好进行史诗中的下一个计划故事
- 开发前需要故事准备

## 输入

**必需的上下文文件：**

- **epics.md**：必需 - 必须明确枚举下一个故事，否则工作流停止
- **tech-spec-epic-{N}-\*.md**：史诗特定技术规格（自动发现）
- **PRD.md**：产品需求文档（需求的后备）
- **架构文档**：从docs/和output文件夹自动发现：
  - tech-stack.md, unified-project-structure.md, coding-standards.md
  - testing-strategy.md, backend-architecture.md, frontend-architecture.md
  - data-models.md, database-schema.md, rest-api-spec.md, external-apis.md

**工作流变量：**

- `story_dir`：来自配置`dev_story_location` - 故事保存位置
- `epic_num`：当前史诗编号（从现有故事自动检测）
- `story_num`：下一个故事编号（从最后完成的故事递增）
- `auto_run_context`：默认true - 创建后运行story-context工作流
- `non_interactive`：默认true - 在"#yolo"模式下运行，最小化提示

## 输出

**主要交付物：**

- **故事文档**（`{story_dir}/story-{epic_num}.{story_num}.md`）：完整故事规范，包括：
  - 用户故事陈述（角色、行动、收益）
  - 从技术规格或epics.md提取的验收标准
  - 映射到AC的任务和子任务
  - 根据测试策略的测试需求
  - 带有源引用的开发说明
  - 状态："草稿"（开发前需要批准）

**验证保障：**

- **史诗枚举检查**：如果epics.md没有列出下一个故事，工作流停止并显示：
  ```
  "在epics.md中未找到史诗{epic_num}的计划下一个故事。
  请加载PM或SM代理并运行*correct-course来添加/修改史诗故事。"
  ```
- **状态检查**：如果当前故事未完成/批准，不会创建新故事
- **文档接地**：所有需求都追溯到源文档（无发明）

## 关键特性

**严格的规划执行**：工作流不会创建在epics.md中没有明确规划的故事。这防止范围蔓延并确保所有工作都通过规划过程得到适当批准。

**智能文档发现**：使用全局模式自动找到史诗的最新技术规格，发现跨多个目录的所有架构文档，并为需求提取构建优先文档集。

**源文档接地**：每个需求、验收标准和技术约束都追溯到特定的源文档。工作流明确禁止发明源材料中不存在的领域事实。

**默认非交互式**：在"#yolo"模式下运行以最小化中断，只在绝对必要时提示（如缺少关键配置）。这实现了顺畅的自动化故事准备。

**自动上下文生成**：当`auto_run_context`为true（默认）时，自动触发story-context工作流为新创建的故事生成开发人员专业知识注入。

## 与v6流程的集成

create-story工作流是v6实施周期中的步骤1：

1. **SM: create-story** ← 您在这里
2. SM: story-context（添加JIT技术专业知识）
3. DEV: dev-story（使用生成的上下文实施）
4. DEV/SR: review-story（验证完成）
5. 如果需要：correct-course（调整方向）
6. 史诗后：retrospective（捕获学习成果）

此工作流基于计划史诗建立需要构建的"内容"。story-context工作流稍后将通过及时技术专业知识注入添加"方法"。

## 文档优先级顺序

工作流使用此优先级提取需求：

1. **tech_spec_file**：史诗范围技术规格（最高优先级）
2. **epics_file**：验收标准和故事分解
3. **prd_file**：业务需求和约束
4. **架构文档**：约束、模式和技术指导

## 工作流行为

**故事编号管理：**

- 从现有文件自动检测下一个故事编号
- 不会跳过编号或创建重复项
- 维持epic.story编号约定

**更新 vs 创建：**

- 如果最新故事状态 != 完成/批准：更新现有故事
- 如果最新故事状态 == 完成/批准：创建下一个故事（如果在epics.md中枚举）

**史诗推进：**

- 非交互模式：保持在当前史诗内
- 交互模式：可以提示新的史诗编号

## 故障排除

**"在epics.md中未找到计划下一个故事"**：下一个故事未在epics.md中枚举。运行SM或PM代理的`*correct-course`来适当规划并将故事添加到史诗。

**缺少story_dir配置**：确保在bmad/bmm/config.yaml中设置了`dev_story_location`

**未找到技术规格**：工作流查找`tech-spec-epic-{N}-*.md`模式。确保技术规格遵循此命名约定。

**缺少架构文档**：虽然不是致命的，但缺少架构文档会降低故事上下文质量。确保关键文档存在于docs/或output文件夹中。